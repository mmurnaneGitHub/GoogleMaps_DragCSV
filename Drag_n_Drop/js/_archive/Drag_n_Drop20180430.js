var map,imageIcon,bounds,infowindow,dropZone;function init(){startLatLng=new google.maps.LatLng(47.255848,-122.441754);map=new google.maps.Map(document.getElementById("map"),{center:startLatLng,zoom:18});imageIcon="images/marker-icon.png";bounds=new google.maps.LatLngBounds();infowindow=new google.maps.InfoWindow();dropZone=document.getElementById("map");dropZone.addEventListener("dragover",handleDragOver,false);dropZone.addEventListener("drop",handleFileSelect,false);};function handleFileSelect(_1){_1.stopPropagation();_1.preventDefault();var _2=_1.dataTransfer.files;var _3=new FileReader();var _4=0;_3.onload=function(_5){var _6=$.csv.toObjects(_5.target.result);if(_6[0].hasOwnProperty("Latitude")&&_6[0].hasOwnProperty("Longitude")){var _7="LatLong";}else{if(_6[0].hasOwnProperty("Address")){var _7="Address";}else{alert("Sorry, no valid fields (Address or Latitude AND Longitude) in table.");return;}}for(i=0;i<_6.length;i++){if(_7=="Address"){url1="https://gis.cityoftacoma.org/arcgis/rest/services/PDS/DART_Locater_AddressPoint_Gazetteer/GeocodeServer/findAddressCandidates?Address=";url2=String(_6[i].Address);url3="&outFields=&outSR=4326&f=pjson";url=url1.concat(url2,url3);var _8=new XMLHttpRequest();_8.open("GET",url,false);_8.send(null);var _9=_8.responseText;var d=JSON.parse(_9);if(typeof d.candidates[0]=="undefined"){alert("Error in address: "+url2);}else{var _a=formatContent(_6[i]);addMarker(d.candidates[0].location.y,d.candidates[0].location.x,String(_6[i].Address),_a);_4++;}}else{if(_7=="LatLong"){if(_6[i].Latitude==""){alert("Sorry, Latitude value missing for record ... "+(i+1));}else{if(_6[i].Longitude==""){alert("Sorry, Longitude value missing for record ... "+(i+1));}else{var _a=formatContent(_6[i]);addMarker(Number(_6[i].Latitude),Number(_6[i].Longitude),String(i),_a);_4++;}}}}}if(_4>0){map.fitBounds(bounds);}};_3.readAsText(_2[0],"UTF-8");};function formatContent(_b){var _c="";for(var _d in _b){_c+="<b>"+_d+": </b>"+_b[_d]+"<br>";}return _c;};function addMarker(_e,_f,_10,_11){var _12=new google.maps.Marker({position:{lat:_e,lng:_f},map:map,icon:imageIcon,title:_10});bounds.extend({lat:_e,lng:_f});google.maps.event.addListener(_12,"click",(function(_13,_14,_15){return function(){_15.setContent(_14);_15.open(map,_13);};})(_12,_11,infowindow));};function handleDragOver(evt){evt.stopPropagation();evt.preventDefault();evt.dataTransfer.dropEffect="copy";};